trials: 3
model_selection_trials: 3
results_dir: /anfs/bigdisc/me466/mixcem_results/color_mnist_add/incomplete_new_best_selected

model_selection_groups:
  - ["^(CBM_Sigmoid_Noisy_Count_Baseline_).*$", "Joint CBM (Baseline)"]
  - ["^(CBM_Sigmoid_Noisy_Count_Downstream_Spurious_).*$", "Joint CBM (Downstream Spurious)"]
  - ["^(CBM_Sigmoid_Noisy_Count_Concept_Spurious_).*$", "Joint CBM (Concept Spurious)"]
  - ["^(Hybrid-CBM_).*(_Baseline_).*$", "Hybrid-CBM (Baseline)"]
  - ["^(Hybrid-CBM_).*(_Downstream_Spurious_).*$", "Hybrid-CBM (Downstream Spurious)"]
  - ["^(Hybrid-CBM_).*(_Concept_Spurious_).*$", "Hybrid-CBM (Concept Spurious)"]
  - ["^(CEM).*(_Noisy_Count_Baseline_).*$", "CEM (Baseline)"]
  - ["^(CEM).*(_Noisy_Count_Downstream_Spurious_).*$", "CEM (Downstream Spurious)"]
  - ["^(CEM).*(_Noisy_Count_Concept_Spurious_).*$", "CEM (Concept Spurious)"]
  - ["^(Sigmoid_CEM).*(_Noisy_Count_Baseline_).*$", "Sigmoidal CEM (Baseline)"]
  - ["^(Sigmoid_CEM).*(_Noisy_Count_Downstream_Spurious_).*$", "Sigmoidal CEM (Downstream Spurious)"]
  - ["^(Sigmoid_CEM).*(_Noisy_Count_Concept_Spurious_).*$", "Sigmoidal CEM (Concept Spurious)"]
  - ["^(IntCEM_).*(_Noisy_Count_Baseline).*$", "IntCEM (Baseline)"]
  - ["^(IntCEM_).*(_Noisy_Count_Concept_Spurious).*$", "IntCEM (Concept Spurious)"]
  - ["^(IntCEM_).*(_Noisy_Count_Downstream_Spurious).*$", "IntCEM (Downstream Spurious)"]
  - ["^(MixCEM_).*(Noisy_Count_Baseline).*$", "MixCEM (Baseline)"]
  - ["^(MixCEM_).*(Noisy_Count_Concept_Spurious).*$", "MixCEM (Concept Spurious)"]
  - ["^(MixCEM_).*(Noisy_Count_Downstream_Spurious).*$", "MixCEM (Downstream Spurious)"]
  - ["^(DNN_).*(Noisy_Count_Baseline).*$", "DNN (Baseline)"]
  - ["^(DNN_).*(Noisy_Count_Concept_Spurious).*$", "DNN (Concept Spurious)"]
  - ["^(DNN_).*(Noisy_Count_Downstream_Spurious).*$", "DNN (Downstream Spurious)"]
  - ["^(ProbCBM).*(_Noisy_Count_Baseline_).*$", "ProbCBM (Baseline)"]
  - ["^(ProbCBM).*(_Noisy_Count_Downstream_Spurious_).*$", "ProbCBM (Downstream Spurious)"]
  - ["^(ProbCBM).*(_Noisy_Count_Concept_Spurious_).*$", "ProbCBM (Concept Spurious)"]
  - ["^(PCBM).*(Baseline).*$", "Posthoc CBM (Baseline)"]
  - ["^(PCBM).*(Downstream_Spurious).*$", "Posthoc CBM (Downstream Spurious)"]
  - ["^(PCBM).*(Concept_Spurious).*$", "Posthoc CBM (Concept Spurious)"]
  - ["^(HybridPCBM).*(Baseline).*$", "Hybrid Posthoc CBM (Baseline)"]
  - ["^(HybridPCBM).*(Downstream_Spurious).*$", "Hybrid Posthoc CBM (Downstream Spurious)"]
  - ["^(HybridPCBM).*(Concept_Spurious).*$", "Hybrid Posthoc CBM (Concept Spurious)"]
  - ["^(MixIntCEM).*(Baseline).*$", "MixIntCEM (Baseline)"]
  - ["^(MixIntCEM).*(Downstream_Spurious).*$", "MixIntCEM (Downstream Spurious)"]
  - ["^(MixIntCEM).*(Concept_Spurious).*$", "MixIntCEM (Concept Spurious)"]
  - ["^(CMixIntCEM).*(Concept_Spurious).*$", "CMixIntCEM (Concept Spurious)"]

model_selection_metrics:
  - val_acc_y_random_group_level_True_use_prior_False_int_auc

shared_params:
  # Intervention Parameters
  intervention_config:
    competence_levels: [1]
    intervention_freq: 1
    intervention_batch_size: 2048
    val_intervention_policies:
      - policy: "random"
        group_level: True
        use_prior: False
    intervention_policies:
      - policy: "random"
        group_level: True
        use_prior: False

  # Evaluation configuration
  eval_config:
    additional_test_sets:
      - name: "OOD"
        update_previous: True
        dataset_config:
          test_transformation_config:
            name: random_noise
            low_noise_level: 1
            noise_level: 0.5


  # Representation metrics
  # Change to False if you want representation metrics to be included in the
  # evaluation (may significantly increase experiment times)
  skip_repr_evaluation: True
  top_k_accuracy: null
  save_model: True
  emb_size: 8
  verbose: True
  extra_dims: 0
  concept_loss_weight: [10, 5, 1] #[10, 1, 0.1]
  learning_rate: 0.001
  c_extractor_arch: color_mnist_extractor
  optimizer: adam
  max_epochs: 500
  bool: False
  early_stopping_monitor: val_loss
  early_stopping_mode: min
  early_stopping_delta: 0.0001
  early_stopping_best_model: False
  patience: 15
  check_val_every_n_epoch: 1
  momentum: 0.9
  sigmoidal_prob: False
  training_intervention_prob: 0.25
  c2y_layers: [32, 16, 8]
  use_task_class_weights: True
  weight_loss: False
  grid_variables:
      - concept_loss_weight
  grid_search_mode: exhaustive

runs:

  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Sigmoid_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive

  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Sigmoid_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive


  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Sigmoid_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive








  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Logit_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: False

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive

  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Logit_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: False

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive


  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Logit_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: False

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
    grid_search_mode: exhaustive





  - architecture: 'ConceptBottleneckModel'
    run_name: "DNN_extra_dims_{extra_dims}_sigmoidal_prob_{sigmoidal_prob}_Noisy_Count_Baseline_{dataset_config[num_operands]}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: [True, False]
    concept_loss_weight: [0]
    extra_dims: [0, 128, 512]

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
      - sigmoidal_prob
    grid_search_mode: exhaustive

  - architecture: 'ConceptBottleneckModel'
    run_name: "DNN_extra_dims_{extra_dims}_sigmoidal_prob_{sigmoidal_prob}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: [True, False]
    concept_loss_weight: [0]
    extra_dims: [0, 128, 512]

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
      - sigmoidal_prob
    grid_search_mode: exhaustive


  - architecture: 'ConceptBottleneckModel'
    run_name: "DNN_extra_dims_{extra_dims}_sigmoidal_prob_{sigmoidal_prob}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: [True, False]
    concept_loss_weight: [0]
    extra_dims: [0, 128, 512]

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
      - sigmoidal_prob
    grid_search_mode: exhaustive






  - architecture: 'ConceptBottleneckModel'
    run_name: "Hybrid-CBM_extra_dims_{extra_dims}_Sigmoid_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    extra_dims: [128, 512]
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
    grid_search_mode: exhaustive


  - architecture: 'ConceptBottleneckModel'
    run_name: "Hybrid-CBM_extra_dims_{extra_dims}_Sigmoid_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    extra_dims: [128, 512]
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
    grid_search_mode: exhaustive


  - architecture: 'ConceptBottleneckModel'
    run_name: "Hybrid-CBM_extra_dims_{extra_dims}_Sigmoid_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    extra_dims: [128, 512]
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - extra_dims
    grid_search_mode: exhaustive




  # - architecture: 'NewMixingConceptEmbeddingModel'
  #   run_name: "Tryout_MixCEM_end_to_end_but_residual_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
  #   emb_size: [1024]
  #   embedding_activation: null
  #   concept_loss_weight: [10] #, 0.1]
  #   normalize_embs: False
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1]
  #   patience: 20 # TRYING OUT. BEFORE: 5 #15
  #   patience: 10
  #   learning_rate: 0.001
  #   use_cosine_similarity: False
  #   check_val_every_n_epoch: 1
  #   early_stopping_best_model: False
  #   conditional_residual: [True] #False, True]
  #   c2y_layers: [256, 128, 64]
  #   residual_layers: [256, 128, 64]
  #   additive_mixing: False
  #   per_concept_residual: False

  #   residual_scale: 1
  #   blackbox_warmup_epochs: 0

  #   concept_epochs: 0
  #   fix_backbone_for_concept: False

  #   no_residual_epochs: 500
  #   fix_backbone_for_no_res: False
  #   fix_concept_embeddings_for_no_res: False

  #   e2e_epochs: 500
  #   fix_backbone_for_res: True
  #   fix_concept_embeddings_for_res: True
  #   fix_label_predictor_for_res: True
  #   use_ground_truth_mixing_for_res: False

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - emb_size
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - conditional_residual
  #   grid_search_mode: exhaustive


  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.1
  #     color_by_label: False
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]

  - architecture: 'NewMixingConceptEmbeddingModel'
    run_name: "Tryout_MixCEM_end_to_end_ip_{training_intervention_prob}_emb_size_{emb_size}_dis_{intervention_task_discount}_sig_res_{sigmoidal_residual}_per_concept_res_{per_concept_residual}_shared_{shared_per_concept_residual}_dev_{residual_deviation}_use_cgt_{use_ground_truth_mixing_for_res}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
    emb_size: [512, 1024]
    embedding_activation: null
    concept_loss_weight: [10] #, 0.1]
    normalize_embs: False
    task_concept_loss: 1
    intervention_task_discount: [1.1, 1.5]
    patience: 15
    learning_rate: 0.001
    use_cosine_similarity: False
    check_val_every_n_epoch: 1
    early_stopping_best_model: False
    conditional_residual: [True] #False, True]
    c2y_layers: [256, 128, 64]
    residual_layers: [256, 128, 64]
    additive_mixing: False
    per_concept_residual: [True]
    sigmoidal_residual: [False]
    residual_deviation: [0, 2]
    shared_per_concept_residual: [True, False] # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    residual_scale: 1
    blackbox_warmup_epochs: 0

    concept_epochs: 0
    fix_backbone_for_concept: False

    no_residual_epochs: 0
    fix_backbone_for_no_res: False
    fix_concept_embeddings_for_no_res: False

    e2e_epochs: 500
    fix_backbone_for_res: False
    fix_concept_embeddings_for_res: False
    fix_label_predictor_for_res: False
    use_ground_truth_mixing_for_res: False

    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - emb_size
      - training_intervention_prob
      - intervention_task_discount
      - conditional_residual
      - per_concept_residual
      - sigmoidal_residual
      - residual_deviation
      - shared_per_concept_residual
    grid_search_mode: exhaustive


    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  # - architecture: 'NewMixingConceptEmbeddingModel'
  #   run_name: "Tryout_MixCEM_end_to_end_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
  #   emb_size: [1024]
  #   embedding_activation: null
  #   concept_loss_weight: [10] #, 0.1]
  #   normalize_embs: False
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1]
  #   patience: 15
  #   learning_rate: 0.001
  #   use_cosine_similarity: False
  #   check_val_every_n_epoch: 1
  #   early_stopping_best_model: False
  #   conditional_residual: [True] #False, True]
  #   c2y_layers: [256, 128, 64]
  #   residual_layers: [256, 128, 64]
  #   additive_mixing: False

  #   residual_scale: 1
  #   blackbox_warmup_epochs: 0

  #   concept_epochs: 0
  #   fix_backbone_for_concept: False

  #   no_residual_epochs: 0
  #   fix_backbone_for_no_res: False
  #   fix_concept_embeddings_for_no_res: False

  #   e2e_epochs: 500
  #   fix_backbone_for_res: False
  #   fix_concept_embeddings_for_res: False
  #   fix_label_predictor_for_res: False
  #   use_ground_truth_mixing_for_res: False

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - emb_size
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - conditional_residual
  #   grid_search_mode: exhaustive


  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.1
  #     color_by_label: False
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]




  # - architecture: 'NewMixingConceptEmbeddingModel'
  #   run_name: "Tryout_MixCEM_staged_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
  #   emb_size: [1024]
  #   embedding_activation: null
  #   concept_loss_weight: [10, 0.1]
  #   normalize_embs: False
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1]
  #   patience: 15
  #   learning_rate: 0.001
  #   use_cosine_similarity: False
  #   check_val_every_n_epoch: 1
  #   early_stopping_best_model: False
  #   conditional_residual: [False, True]

  #   # First warmup the backbone
  #   residual_scale: 1
  #   blackbox_warmup_epochs: 50

  #   # Then train the concept embeddings without any task loss
  #   concept_epochs: 50
  #   fix_backbone_for_concept: True #False

  #   # At this point, we train the label predictor with the concept embeddings and backbone fixed
  #   no_residual_epochs: 50
  #   fix_backbone_for_no_res: True #False
  #   fix_concept_embeddings_for_no_res: True #False

  #   # Finally, we train the residual model while also fixing the label predictor as well as all other parts
  #   e2e_epochs: 50
  #   fix_backbone_for_res: True #False
  #   fix_concept_embeddings_for_res: True #False
  #   fix_label_predictor_for_res: True #False
  #   use_ground_truth_mixing_for_res: False

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - emb_size
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - conditional_residual
  #   grid_search_mode: exhaustive


  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.1
  #     color_by_label: False
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]









  - architecture: 'NewMixingConceptEmbeddingModel'
    run_name: "Tryout_MixCEM_end_to_end_with_per_concept_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
    emb_size: [1024]
    embedding_activation: null
    concept_loss_weight: [10] #, 0.1]
    normalize_embs: False
    task_concept_loss: 1
    intervention_task_discount: [1.1]
    patience: 15
    learning_rate: 0.001
    use_cosine_similarity: False
    check_val_every_n_epoch: 1
    early_stopping_best_model: False
    conditional_residual: [True] #False, True]
    c2y_layers: [256, 128, 64]
    residual_layers: [256, 128, 64]
    additive_mixing: False
    per_concept_residual: True

    residual_scale: 1
    blackbox_warmup_epochs: 0

    concept_epochs: 0
    fix_backbone_for_concept: False

    no_residual_epochs: 0
    fix_backbone_for_no_res: False
    fix_concept_embeddings_for_no_res: False

    e2e_epochs: 500
    fix_backbone_for_res: False
    fix_concept_embeddings_for_res: False
    fix_label_predictor_for_res: False
    use_ground_truth_mixing_for_res: False

    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - emb_size
      - training_intervention_prob
      - intervention_task_discount
      - conditional_residual
    grid_search_mode: exhaustive


    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'NewMixingConceptEmbeddingModel'
    run_name: "Tryout_MixCEM_end_to_end_with_per_concept_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
    emb_size: [1024]
    embedding_activation: null
    concept_loss_weight: [10] #, 0.1]
    normalize_embs: False
    task_concept_loss: 1
    intervention_task_discount: [1.1]
    patience: 15
    learning_rate: 0.001
    use_cosine_similarity: False
    check_val_every_n_epoch: 1
    early_stopping_best_model: False
    conditional_residual: [True] #False, True]
    c2y_layers: [256, 128, 64]
    residual_layers: [256, 128, 64]
    additive_mixing: False
    per_concept_residual: True

    residual_scale: 1
    blackbox_warmup_epochs: 0

    concept_epochs: 0
    fix_backbone_for_concept: False

    no_residual_epochs: 0
    fix_backbone_for_no_res: False
    fix_concept_embeddings_for_no_res: False

    e2e_epochs: 500
    fix_backbone_for_res: False
    fix_concept_embeddings_for_res: False
    fix_label_predictor_for_res: False
    use_ground_truth_mixing_for_res: False

    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - emb_size
      - training_intervention_prob
      - intervention_task_discount
      - conditional_residual
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'NewMixingConceptEmbeddingModel'
    run_name: "Tryout_MixCEM_end_to_end_with_per_concept_ip_{training_intervention_prob}_emb_size_{emb_size}_use_ground_truth_{use_ground_truth_mixing_for_res}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: [[0.25, 0.5, 0.75, 1]]
    emb_size: [1024]
    embedding_activation: null
    concept_loss_weight: [10] #, 0.1]
    normalize_embs: False
    task_concept_loss: 1
    intervention_task_discount: [1.1]
    patience: 15
    learning_rate: 0.001
    use_cosine_similarity: False
    check_val_every_n_epoch: 1
    early_stopping_best_model: False
    conditional_residual: [True] #False, True]
    c2y_layers: [256, 128, 64]
    residual_layers: [256, 128, 64]
    additive_mixing: False
    per_concept_residual: True

    residual_scale: 1
    blackbox_warmup_epochs: 0

    concept_epochs: 0
    fix_backbone_for_concept: False

    no_residual_epochs: 0
    fix_backbone_for_no_res: False
    fix_concept_embeddings_for_no_res: False

    e2e_epochs: 500
    fix_backbone_for_res: False
    fix_concept_embeddings_for_res: False
    fix_label_predictor_for_res: False
    use_ground_truth_mixing_for_res: False

    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - emb_size
      - training_intervention_prob
      - intervention_task_discount
      - conditional_residual
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]










  # - architecture: 'MixingConceptEmbeddingModel'
  #   run_name: "MixCEM_n_extra_{n_discovered_concepts}_entr_{discovered_probs_entropy}_dis_{intervention_task_discount}_ip_{training_intervention_prob}_dip_{dyn_training_intervention_prob}_cl_{contrastive_loss_weight}_mix_{mix_ground_truth_embs}_shared_{shared_emb_generator}_emb_size_{emb_size}_ml_{intermediate_task_concept_loss}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]] #[0.25, [0.25, 0.5]] #[0.25, [0.25, 0.5]]
  #   emb_size: [64] # TRYING OUT. BEFORE: [256, 64, 16, 8] # [128, 64] #[256, 128] # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   embedding_activation: null
  #   n_discovered_concepts: [50] # TRYING OUT. BEFORE: [25, 5, 0] # [5, 2, 1, 0] #[10, 5, 0] # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   concept_loss_weight: [1] # TRYING OUT. BEFORE: [10, 1] #, 1, 0.1] CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  #   contrastive_loss_weight: [0] #, 1]
  #   mix_ground_truth_embs: True
  #   shared_emb_generator: [True] #[True, False]
  #   normalize_embs: False
  #   sample_probs: False
  #   cond_discovery: False
  #   intermediate_task_concept_loss: [0]  #, 1, 0.1] CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! , 0.1] #[1, 0.5, 0.1] #, 0.1, 1]
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1] # TRYING OUT. BEFORE: [1.1, 1.5] #[1.01, 1.1, 1.5]
  #   discovered_probs_entropy: 0
  #   dyn_training_intervention_prob: [0.1] # TRYING OUT. BEFORE: [0.1, 0.25] #, 0.5, 1] #[0, 1]
  #   patience: 20 # TRYING OUT. BEFORE: 5 #15
  #   learning_rate: 0.001 # TRYING OUT. BEFORE: 0.001
  #   use_cosine_similarity: False # TRYING OUT. BEFORE: False
  #   check_val_every_n_epoch: 1 #5
  #   concept_warmup_epochs: 20 # TRYING OUT. BEFORE: 0
  #   early_stopping_best_model: False # TRYING OUT. BEFORE: False

  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.1
  #     color_by_label: False
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - n_discovered_concepts
  #     - contrastive_loss_weight
  #     - shared_emb_generator
  #     - emb_size
  #     - intermediate_task_concept_loss
  #     - intervention_task_discount
  #     - training_intervention_prob
  #     - dyn_training_intervention_prob
  #   grid_search_mode: exhaustive

  # - architecture: 'MixingConceptEmbeddingModel'
  #   run_name: "MixCEM_n_extra_{n_discovered_concepts}_entr_{discovered_probs_entropy}_dis_{intervention_task_discount}_ip_{training_intervention_prob}_dip_{dyn_training_intervention_prob}_cl_{contrastive_loss_weight}_mix_{mix_ground_truth_embs}_shared_{shared_emb_generator}_emb_size_{emb_size}_ml_{intermediate_task_concept_loss}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]] #[0.25, [0.25, 0.5]] #[0.25, [0.25, 0.5]]
  #   emb_size: [256, 64, 16, 8] # [128, 64] #[256, 128] # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   embedding_activation: null
  #   n_discovered_concepts: [25, 5, 0] # [5, 2, 1, 0] #[10, 5, 0] # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   concept_loss_weight: [10, 1] #, 1, 0.1] CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  #   contrastive_loss_weight: [0] #, 1]
  #   mix_ground_truth_embs: True
  #   shared_emb_generator: [True] #[True, False]
  #   normalize_embs: False
  #   sample_probs: False
  #   cond_discovery: False
  #   intermediate_task_concept_loss: [0]  #, 1, 0.1] CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! , 0.1] #[1, 0.5, 0.1] #, 0.1, 1]
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1, 1.5] #[1.01, 1.1, 1.5]
  #   discovered_probs_entropy: 0
  #   dyn_training_intervention_prob: [0.1, 0.25] #, 0.5, 1] #[0, 1]
  #   use_cosine_similarity: False
  #   early_stopping_best_model: False

  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.1
  #     color_by_label: False
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - n_discovered_concepts
  #     - contrastive_loss_weight
  #     - shared_emb_generator
  #     - emb_size
  #     - intermediate_task_concept_loss
  #     - intervention_task_discount
  #     - training_intervention_prob
  #     - dyn_training_intervention_prob
  #   grid_search_mode: exhaustive

  # - architecture: 'MixingConceptEmbeddingModel'
  #   run_name: "MixCEM_n_extra_{n_discovered_concepts}_entr_{discovered_probs_entropy}_dis_{intervention_task_discount}_ip_{training_intervention_prob}_dip_{dyn_training_intervention_prob}_cl_{contrastive_loss_weight}_mix_{mix_ground_truth_embs}_shared_{shared_emb_generator}_emb_size_{emb_size}_ml_{intermediate_task_concept_loss}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]] #[0.25, [0.25, 0.5]] #[0.25, [0.25, 0.5]]
  #   emb_size: [64, 8] # [128, 64] #[256, 128]  # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   embedding_activation: null
  #   n_discovered_concepts: [5, 0] # [5, 2, 0] # [10, 5, 0]  # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   concept_loss_weight: [10]
  #   contrastive_loss_weight: [0] #, 1]
  #   mix_ground_truth_embs: True
  #   shared_emb_generator: [True] #[True, False]
  #   normalize_embs: False
  #   sample_probs: False
  #   cond_discovery: False
  #   intermediate_task_concept_loss: [0] #[1, 0.5, 0.1] #, 0.1, 1]
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1, 1.5] #[1.01, 1.1, 1.5]
  #   discovered_probs_entropy: 0
  #   dyn_training_intervention_prob: [0.1, 0.25] #, 0.5, 1] #[0, 1]

  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.95
  #     color_by_label: True    # So that the spurious correlation is label-based!
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - n_discovered_concepts
  #     - contrastive_loss_weight
  #     - shared_emb_generator
  #     - emb_size
  #     - intermediate_task_concept_loss
  #     - intervention_task_discount
  #     - training_intervention_prob
  #     - dyn_training_intervention_prob
  #   grid_search_mode: exhaustive


  # - architecture: 'MixingConceptEmbeddingModel'
  #   run_name: "MixCEM_n_extra_{n_discovered_concepts}_entr_{discovered_probs_entropy}_dis_{intervention_task_discount}_ip_{training_intervention_prob}_dip_{dyn_training_intervention_prob}_cl_{contrastive_loss_weight}_mix_{mix_ground_truth_embs}_shared_{shared_emb_generator}_emb_size_{emb_size}_ml_{intermediate_task_concept_loss}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   training_intervention_prob: [[0.25, 0.5, 0.75, 1]] #[0.25, [0.25, 0.5]] #[0.25, [0.25, 0.5]]
  #   emb_size: [64, 8] # [128, 64] #[256, 128]  # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   embedding_activation: null
  #   n_discovered_concepts: [5, 0] # [5, 2, 0] # [10, 5, 0]  # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #   concept_loss_weight: [10]
  #   contrastive_loss_weight: [0] #, 1]
  #   mix_ground_truth_embs: True
  #   shared_emb_generator: [True] #[True, False]
  #   normalize_embs: False
  #   sample_probs: False
  #   cond_discovery: False
  #   intermediate_task_concept_loss: [0] #[1, 0.5, 0.1] #, 0.1, 1]
  #   task_concept_loss: 1
  #   intervention_task_discount: [1.1, 1.5] #[1.01, 1.1, 1.5]
  #   discovered_probs_entropy: 0
  #   dyn_training_intervention_prob: [0.1, 0.25] #, 0.5, 1] #[0, 1]

  #   # Dataset Configuration
  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.95
  #     color_by_label: False    # So that the spurious correlation is concept-based!
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #   grid_variables:
  #     - dataset_config.num_operands
  #     - concept_loss_weight
  #     - n_discovered_concepts
  #     - contrastive_loss_weight
  #     - shared_emb_generator
  #     - emb_size
  #     - intermediate_task_concept_loss
  #     - intervention_task_discount
  #     - training_intervention_prob
  #     - dyn_training_intervention_prob
  #   grid_search_mode: exhaustive








  - architecture: 'ConceptEmbeddingModel'
    run_name: "CEM_emb_size_{emb_size}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    emb_size: [64, 32, 16, 8]
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - emb_size
    grid_search_mode: exhaustive

  - architecture: 'ConceptEmbeddingModel'
    run_name: "CEM_emb_size_{emb_size}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    emb_size: [64, 32, 16, 8]
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - emb_size
    grid_search_mode: exhaustive


  - architecture: 'ConceptEmbeddingModel'
    run_name: "CEM_emb_size_{emb_size}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    emb_size: [64, 32, 16, 8]
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - emb_size
    grid_search_mode: exhaustive









  - architecture: 'IntAwareConceptEmbeddingModel'
    run_name: "IntCEM_emb_size_{emb_size}_intervention_weight_{intervention_weight}_intervention_task_discount_{intervention_task_discount}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    intervention_weight: [0.1, 1, 5]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    embedding_activation: "leakyrelu"
    max_horizon: 6
    horizon_rate: 1.005
    gradient_clip_val: 100
    emb_size: [32, 16, 8]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - intervention_task_discount
      - intervention_weight
      - emb_size
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]

  - architecture: 'IntAwareConceptEmbeddingModel'
    run_name: "IntCEM_emb_size_{emb_size}_intervention_weight_{intervention_weight}_intervention_task_discount_{intervention_task_discount}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    intervention_weight: [0.1, 1, 5]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    embedding_activation: "leakyrelu"
    max_horizon: 6
    horizon_rate: 1.005
    gradient_clip_val: 100
    emb_size: [32, 16, 8]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - intervention_task_discount
      - intervention_weight
      - emb_size
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'IntAwareConceptEmbeddingModel'
    run_name: "IntCEM_emb_size_{emb_size}_intervention_weight_{intervention_weight}_intervention_task_discount_{intervention_task_discount}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    training_intervention_prob: 0.25
    intervention_weight: [0.1, 1, 5]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    embedding_activation: "leakyrelu"
    max_horizon: 6
    horizon_rate: 1.005
    gradient_clip_val: 100
    emb_size: [32, 16, 8]
    grid_variables:
      - concept_loss_weight
      - dataset_config.num_operands
      - intervention_task_discount
      - intervention_weight
      - emb_size
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]








  - architecture: 'ProbabilisticConceptBottleneckModel'
    run_name: "ProbCBM_cwl_class_hidden_dim_{class_hidden_dim}_hidden_dim_{hidden_dim}_n_samples_inference_{n_samples_inference}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    n_samples_inference: 50
    use_neg_concept: True
    pred_class: True
    init_negative_scale: 5
    init_shift: 5
    pretrained: True
    hidden_dim: [16, 32]
    class_hidden_dim: [128, 256]
    intervention_prob: 0.5
    gradient_clip_val: 2.0
    max_concept_epochs: 250
    warmup_epochs: 5
    max_task_epochs: 250
    vib_beta: 0.00005
    concept_loss_weight: [1]
    learning_rate: 0.001
    lr_ratio: 10
    weight_decay: 0
    weight_loss: False
    optimizer: adam

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - hidden_dim
      - class_hidden_dim
    grid_search_mode: exhaustive


  - architecture: 'ProbabilisticConceptBottleneckModel'
    run_name: "ProbCBM_cwl_class_hidden_dim_{class_hidden_dim}_hidden_dim_{hidden_dim}_n_samples_inference_{n_samples_inference}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    n_samples_inference: 50
    use_neg_concept: True
    pred_class: True
    init_negative_scale: 5
    init_shift: 5
    pretrained: True
    hidden_dim: [16, 32]
    class_hidden_dim: [128, 256]
    intervention_prob: 0.5
    gradient_clip_val: 2.0
    max_concept_epochs: 250
    warmup_epochs: 5
    max_task_epochs: 250
    vib_beta: 0.00005
    concept_loss_weight: [1]
    learning_rate: 0.001
    lr_ratio: 10
    weight_decay: 0
    weight_loss: False
    optimizer: adam

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - hidden_dim
      - class_hidden_dim
    grid_search_mode: exhaustive


  - architecture: 'ProbabilisticConceptBottleneckModel'
    run_name: "ProbCBM_cwl_class_hidden_dim_{class_hidden_dim}_hidden_dim_{hidden_dim}_n_samples_inference_{n_samples_inference}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    n_samples_inference: 50
    use_neg_concept: True
    pred_class: True
    init_negative_scale: 5
    init_shift: 5
    pretrained: True
    hidden_dim: [16, 32]
    class_hidden_dim: [128, 256]
    intervention_prob: 0.5
    gradient_clip_val: 2.0
    max_concept_epochs: 250
    warmup_epochs: 5
    max_task_epochs: 250
    vib_beta: 0.00005
    concept_loss_weight: [1]
    learning_rate: 0.001
    lr_ratio: 10
    weight_decay: 0
    weight_loss: False
    optimizer: adam

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    grid_variables:
      - dataset_config.num_operands
      - concept_loss_weight
      - hidden_dim
      - class_hidden_dim
    grid_search_mode: exhaustive











  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "PCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: False
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]

  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "PCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: False
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "PCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: False
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]







  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "HybridPCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: True
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]

  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "HybridPCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: True
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'PosthocConceptBottleneckModel'
    run_name: "HybridPCBM_reg_{reg_strength}_l1_{l1_ratio}_penalty_{svd_penalty}_Noisy_Count_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    residual: True
    reg_strength: [0.000001, 0.001, 0.1]
    l1_ratio: [0.99]
    freeze_pretrained_model: True
    freeze_concept_embeddings: True
    emb_size: null

    svd_penalty: [1]
    active_top_percentile: 95
    active_bottom_percentile: 5
    blackbox_model_config:
      name: color_mnist_extractor
      output_dim: 32  # Add an intermediate layer with the same size as the number of concepts so that the evaluation is fair
    blackbox_training_epochs: 150
    max_residual_epochs: 150
    max_epochs: 150
    blackbox_path: 'PCBM_BlackBox_Model_{blackbox_model_config[name]}_fold_{split}_layers_{blackbox_model_config[output_dim]}'


    grid_variables:
      - dataset_config.num_operands
      - reg_strength
      - l1_ratio
      - svd_penalty
    grid_search_mode: exhaustive

    # Dataset Configuration
    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 #2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]















  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Baseline_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 5]
    emb_size: [16]
    temperature: [10] #, 1]
    shared_emb_generator: True

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0.5]
    pooling_mode: ['iss'] #, 'is']
    selection_mode: ['max_class_confidence']
    hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1.5
    init_global_temps: 0.5
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: "leakyrelu"
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: 5

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048 # CHANGING CAUSE GPU MEMORY IS NOT ENOUGH
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.1
      color_by_label: False
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Downstream_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 5]
    emb_size: [16]
    temperature: [10] #, 1]
    shared_emb_generator: True

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0.5]
    pooling_mode: ['iss'] #, 'is']
    selection_mode: ['max_class_confidence']
    hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1.5
    init_global_temps: 0.5
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: 5

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
    grid_search_mode: exhaustive

    # Dataset Configuration
    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: True    # So that the spurious correlation is label-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]




  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "FMixIntCEM_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "FMixIntCEM_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [1]
    emb_size: [16]
    temperature: [10]
    max_temperature: 10
    shared_emb_generator: True

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0.5]
    entire_global_prob: [0]
    pooling_mode: ['iss']
    selection_mode: ['max_class_confidence']
    hard_eval_selection: [null, 0.5]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1.5
    init_global_temps: 0.5
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False
    positive_calibration: False
    class_wise_temperature: False
    separate_calibration: False
    freeze_global_components: [False]
    global_epochs: 200
    max_epochs: 200
    print_eval_only: True
    counter_limit: 0
    patience: 5 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    check_val_every_n_epoch: 5 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: [0.1] #, 5]

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - entire_global_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
      - intervention_weight
      - freeze_global_components
    grid_search_mode: exhaustive

    # Intervention Parameters
    intervention_config:
      competence_levels: [1]
      intervention_freq: 1
      intervention_batch_size: 128
      val_intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False
      intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False


    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 128 #2048
      num_operands: [10]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "CMixIntCEM_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "CMixIntCEM_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 1]
    emb_size: [16, 32]
    temperature: [1]
    max_temperature: 1
    shared_emb_generator: True
    learning_rate: 0.001

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0.5, 0.75]
    entire_global_prob: [0]
    pooling_mode: ['iss']
    selection_mode: ['max_concept_confidence']
    hard_eval_selection: [null]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1
    init_global_temps: 1
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False
    positive_calibration: False
    class_wise_temperature: False
    separate_calibration: False
    freeze_global_components: [False, True]
    global_epochs: [0, 30, 100]
    print_eval_only: True
    counter_limit: 0
    patience: 10 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    # check_val_every_n_epoch: 1 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    gradient_clip_val: 100
    intervention_weight: [0.1] #, 5]

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - entire_global_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
      - intervention_weight
      - freeze_global_components
      - global_epochs
    grid_search_mode: exhaustive

    # Intervention Parameters
    intervention_config:
      competence_levels: [1]
      intervention_freq: 1
      intervention_batch_size: 128
      val_intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False
      intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False


    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 128 #2048
      num_operands: [10]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]




  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "CMixIntCEM_lr_{learning_rate}_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "CMixIntCEM_lr_{learning_rate}_{global_epochs}_{max_epochs}_{freeze_global_components}_t_{temperature}_mt_{max_temperature}_cwc_{class_wise_temperature}_{positive_calibration}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_ood_{global_ood_prob}_{entire_global_prob}_e_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 1]
    emb_size: [16]
    temperature: [1]
    max_temperature: 1
    shared_emb_generator: True
    learning_rate: 0.0001

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0]
    entire_global_prob: [0.5, 1]
    pooling_mode: ['iss']
    selection_mode: ['max_concept_confidence']
    hard_eval_selection: [null, 0.5]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1
    init_global_temps: 1
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False
    positive_calibration: False
    class_wise_temperature: False
    separate_calibration: False
    freeze_global_components: [False]
    global_epochs: 100
    print_eval_only: True
    counter_limit: 0
    patience: 10 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    # check_val_every_n_epoch: 1 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: [0.1] #, 5]

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - entire_global_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
      - intervention_weight
      - freeze_global_components
    grid_search_mode: exhaustive

    # Intervention Parameters
    intervention_config:
      competence_levels: [1]
      intervention_freq: 1
      intervention_batch_size: 128
      val_intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False
      intervention_policies:
        - policy: "random"
          group_level: True
          use_prior: False


    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 128 #2048
      num_operands: [10]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "MixIntCEM_{pooling_mode}_t_{temperature}_mt_{max_temperature}_pc_{positive_calibration}_cwc_{class_wise_temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_{entire_global_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "MixIntCEM_{pooling_mode}_t_{temperature}_mt_{max_temperature}_pc_{positive_calibration}_cwc_{class_wise_temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_{entire_global_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 5]
    emb_size: [16]
    temperature: [10, 1]
    max_temperature: 10 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!
    shared_emb_generator: True

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0]
    entire_global_prob: [0]
    pooling_mode: ['iss']
    selection_mode: ['max_class_confidence']
    hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1.5
    init_global_temps: 0.5
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False
    positive_calibration: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!
    class_wise_temperature: False # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    separate_calibration: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    patience: 15 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    check_val_every_n_epoch: 5 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    freeze_global_components: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    global_epochs: 50 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    max_epochs: 50 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    print_eval_only: True
    counter_limit: 0

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: [0.1] #, 5]

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - entire_global_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
      - intervention_weight
    grid_search_mode: exhaustive

    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256 # 2048
      num_operands: [10] #[10, 20]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  - architecture: 'CertificateConceptEmbeddingModel'
    run_name: "MixIntCEM_{pooling_mode}_t_{temperature}_mt_{max_temperature}_pc_{positive_calibration}_cwc_{class_wise_temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_{entire_global_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
    load_path_name: "MixIntCEM_{pooling_mode}_t_{temperature}_mt_{max_temperature}_pc_{positive_calibration}_cwc_{class_wise_temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_{entire_global_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

    concept_loss_weight: [10, 5]
    emb_size: [16]
    temperature: [10, 1]
    max_temperature: 10 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!
    shared_emb_generator: True

    # OOD stuff
    certificate_loss_weight: [0]
    ood_dropout_prob: [0]
    global_ood_prob: [0]
    entire_global_prob: [0]
    pooling_mode: ['iss']
    selection_mode: ['max_class_confidence']
    hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
    selection_sample: [False]
    calibration_epochs: [0, 30]
    mixed_probs: True
    contrastive_reg: 0
    calibrate_dynamic_logits: True
    calibrate_global_logits: True
    finetune_with_val: [True]
    init_dyn_temps: 1
    init_global_temps: 1
    global_temp_reg: 0
    inference_dyn_prob: False
    learnable_temps: False
    positive_calibration: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!
    class_wise_temperature: False # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    separate_calibration: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    patience: 15 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    check_val_every_n_epoch: 5 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    freeze_global_components: True # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    global_epochs: 50 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    max_epochs: 50 # CHANGE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    print_eval_only: True
    counter_limit: 0

    ###############################################################################################

    # IntCEM stuff
    embedding_activation: null
    training_intervention_prob: [0.25]
    intervention_task_discount: [1.5]
    use_concept_groups: True
    int_model_use_bn: True
    int_model_layers: [128, 128, 64, 64]
    max_horizon: 6
    horizon_rate: 1.005
    intervention_weight: [0.1]

    grid_variables:
      - dataset_config.num_operands
      - training_intervention_prob
      - intervention_task_discount
      - emb_size
      - certificate_loss_weight
      - ood_dropout_prob
      - selection_mode
      - hard_eval_selection
      - selection_sample
      - global_ood_prob
      - entire_global_prob
      - temperature
      - finetune_with_val
      - calibration_epochs
      - concept_loss_weight
      - pooling_mode
      - intervention_weight
    grid_search_mode: exhaustive

    dataset_config:
      dataset: color_mnist_add
      root_dir: data/
      num_workers: 8
      batch_size: 256
      num_operands: [10]
      selected_digits: [0, 1, 2, 3]
      count_labels: False
      range_labels: [5, 10, 15, 20, 25]
      low_noise_level: 1
      noise_level: 0.25
      test_low_noise_level: 1
      test_noise_level: 0.25
      train_dataset_size: 5000
      test_dataset_size: 5000
      sampling_percent: 0.8
      sampling_groups: True
      test_subsampling: 1
      weight_loss: False

      spurious_strength: 0.95
      color_by_label: False    # So that the spurious correlation is concept-based!
      colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
      digit_color_distribution:
        0: ["spurious", null, null, null, null, null, null, null, null, null]
        1: [null, "spurious", null, null, null, null, null, null, null, null]
        2: [null, null, "spurious", null, null, null, null, null, null, null]
        3: [null, null, null, "spurious", null, null, null, null, null, null]
        4: [null, null, null, null, "spurious", null, null, null, null, null]
        5: [null, null, null, null, null, "spurious", null, null, null, null]
        6: [null, null, null, null, null, null, "spurious", null, null, null]
        7: [null, null, null, null, null, null, null, "spurious", null, null]
        8: [null, null, null, null, null, null, null, null, "spurious", null]
        9: [null, null, null, null, null, null, null, null, null, "spurious"]

      test_digit_color_distribution:
        0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
        9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]


  # - architecture: 'CertificateConceptEmbeddingModel'
  #   run_name: "CertificateVanillaCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   load_path_name: "CertificateVanillaCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

  #   concept_loss_weight: [10, 5]
  #   emb_size: [16]
  #   temperature: [10] #, 1]
  #   shared_emb_generator: True

  #   # OOD stuff
  #   certificate_loss_weight: [0]
  #   ood_dropout_prob: [0]
  #   global_ood_prob: [0.5]
  #   pooling_mode: ['iss'] #, 'is']
  #   selection_mode: ['max_class_confidence']
  #   hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
  #   selection_sample: [False]
  #   calibration_epochs: [0, 30]
  #   mixed_probs: True
  #   contrastive_reg: 0
  #   calibrate_dynamic_logits: True
  #   calibrate_global_logits: True
  #   finetune_with_val: [True]
  #   init_dyn_temps: 1.5
  #   init_global_temps: 0.5
  #   global_temp_reg: 0
  #   inference_dyn_prob: False
  #   learnable_temps: False

  #   ###############################################################################################

  #   # IntCEM stuff
  #   embedding_activation: null
  #   training_intervention_prob: [0.25]
  #   intervention_task_discount: [1]
  #   use_concept_groups: True
  #   int_model_use_bn: True
  #   int_model_layers: [128, 128, 64, 64]
  #   max_horizon: 1
  #   horizon_rate: 1
  #   intervention_weight: [0]
  #   patience: 15
  #   check_val_every_n_epoch: 5

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - emb_size
  #     - certificate_loss_weight
  #     - ood_dropout_prob
  #     - selection_mode
  #     - hard_eval_selection
  #     - selection_sample
  #     - global_ood_prob
  #     - temperature
  #     - finetune_with_val
  #     - calibration_epochs
  #     - concept_loss_weight
  #     - pooling_mode
  #     - intervention_weight
  #   grid_search_mode: exhaustive

  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 # 2048
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.95
  #     color_by_label: False    # So that the spurious correlation is concept-based!
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  # - architecture: 'CertificateConceptEmbeddingModel'
  #   run_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   load_path_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

  #   concept_loss_weight: [10, 5]
  #   emb_size: [16]
  #   temperature: [10] #, 1]
  #   shared_emb_generator: True

  #   # OOD stuff
  #   certificate_loss_weight: [0]
  #   ood_dropout_prob: [0]
  #   global_ood_prob: [0.5]
  #   pooling_mode: ['iss'] #, 'is']
  #   selection_mode: ['max_class_confidence']
  #   hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
  #   selection_sample: [False]
  #   calibration_epochs: [0, 30]
  #   mixed_probs: True
  #   contrastive_reg: 0
  #   calibrate_dynamic_logits: True
  #   calibrate_global_logits: True
  #   finetune_with_val: [True]
  #   init_dyn_temps: 1.5
  #   init_global_temps: 0.5
  #   global_temp_reg: 0
  #   inference_dyn_prob: False
  #   learnable_temps: False

  #   ###############################################################################################

  #   # IntCEM stuff
  #   embedding_activation: null
  #   training_intervention_prob: [0.25]
  #   intervention_task_discount: [1.5]
  #   use_concept_groups: True
  #   int_model_use_bn: True
  #   int_model_layers: [128, 128, 64, 64]
  #   max_horizon: 6
  #   horizon_rate: 1.005
  #   intervention_weight: [0.1, 5]

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - emb_size
  #     - certificate_loss_weight
  #     - ood_dropout_prob
  #     - selection_mode
  #     - hard_eval_selection
  #     - selection_sample
  #     - global_ood_prob
  #     - temperature
  #     - finetune_with_val
  #     - calibration_epochs
  #     - concept_loss_weight
  #     - pooling_mode
  #     - intervention_weight
  #   grid_search_mode: exhaustive

  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 # 2048
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.95
  #     color_by_label: False    # So that the spurious correlation is concept-based!
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]



  # - architecture: 'CertificateConceptEmbeddingModel'
  #   run_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_{hard_eval_selection}_ce_{calibration_epochs}_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"
  #   load_path_name: "CertificateCEM_{selection_mode}_{pooling_mode}_t_{temperature}_{calibrate_global_logits}_{calibrate_dynamic_logits}_{init_dyn_temps}_{init_global_temps}_gr_{global_temp_reg}_g_ood_{global_ood_prob}_emb_{emb_size}_idp_{inference_dyn_prob}_hs_None_ce_0_{finetune_with_val}_tip_{training_intervention_prob}_itd_{intervention_task_discount}_iw_{intervention_weight}_Concept_Spurious_{dataset_config[num_operands]}_cwl_{concept_loss_weight}"

  #   concept_loss_weight: [10, 5]
  #   emb_size: [16]
  #   temperature: [10] #, 1]
  #   shared_emb_generator: True

  #   # OOD stuff
  #   certificate_loss_weight: [0]
  #   ood_dropout_prob: [0]
  #   global_ood_prob: [0.5]
  #   pooling_mode: ['iss'] #, 'is']
  #   selection_mode: ['max_class_confidence']
  #   hard_eval_selection: [null, 0.5] #, 0.05, 0.95]
  #   selection_sample: [False]
  #   calibration_epochs: [0, 30]
  #   mixed_probs: True
  #   contrastive_reg: 0
  #   calibrate_dynamic_logits: True
  #   calibrate_global_logits: True
  #   finetune_with_val: [True]
  #   init_dyn_temps: 1
  #   init_global_temps: 1
  #   global_temp_reg: 0
  #   inference_dyn_prob: False
  #   learnable_temps: False

  #   ###############################################################################################

  #   # IntCEM stuff
  #   embedding_activation: null
  #   training_intervention_prob: [0.25]
  #   intervention_task_discount: [1.5]
  #   use_concept_groups: True
  #   int_model_use_bn: True
  #   int_model_layers: [128, 128, 64, 64]
  #   max_horizon: 6
  #   horizon_rate: 1.005
  #   intervention_weight: [0.1, 5]

  #   grid_variables:
  #     - dataset_config.num_operands
  #     - training_intervention_prob
  #     - intervention_task_discount
  #     - emb_size
  #     - certificate_loss_weight
  #     - ood_dropout_prob
  #     - selection_mode
  #     - hard_eval_selection
  #     - selection_sample
  #     - global_ood_prob
  #     - temperature
  #     - finetune_with_val
  #     - calibration_epochs
  #     - concept_loss_weight
  #     - pooling_mode
  #     - intervention_weight
  #   grid_search_mode: exhaustive

  #   dataset_config:
  #     dataset: color_mnist_add
  #     root_dir: data/
  #     num_workers: 8
  #     batch_size: 256 # 2048
  #     num_operands: [10] #[10, 20]
  #     selected_digits: [0, 1, 2, 3]
  #     count_labels: False
  #     range_labels: [5, 10, 15, 20, 25]
  #     low_noise_level: 1
  #     noise_level: 0.25
  #     test_low_noise_level: 1
  #     test_noise_level: 0.25
  #     train_dataset_size: 5000
  #     test_dataset_size: 5000
  #     sampling_percent: 0.8
  #     sampling_groups: True
  #     test_subsampling: 1
  #     weight_loss: False

  #     spurious_strength: 0.95
  #     color_by_label: False    # So that the spurious correlation is concept-based!
  #     colors: ["random_1", "random_2", "random_3", "random_4", "random_5", "random_6", "random_7", "random_8", "random_9", "random_10"]
  #     digit_color_distribution:
  #       0: ["spurious", null, null, null, null, null, null, null, null, null]
  #       1: [null, "spurious", null, null, null, null, null, null, null, null]
  #       2: [null, null, "spurious", null, null, null, null, null, null, null]
  #       3: [null, null, null, "spurious", null, null, null, null, null, null]
  #       4: [null, null, null, null, "spurious", null, null, null, null, null]
  #       5: [null, null, null, null, null, "spurious", null, null, null, null]
  #       6: [null, null, null, null, null, null, "spurious", null, null, null]
  #       7: [null, null, null, null, null, null, null, "spurious", null, null]
  #       8: [null, null, null, null, null, null, null, null, "spurious", null]
  #       9: [null, null, null, null, null, null, null, null, null, "spurious"]

  #     test_digit_color_distribution:
  #       0: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       1: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       2: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       3: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       4: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       5: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       6: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       7: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       8: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  #       9: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]






