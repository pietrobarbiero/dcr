trials: 3
model_selection_trials: 1
results_dir: /anfs/bigdisc/me466/cub_competence_results/

num_load_workers: 0

model_selection_groups:
  - ["^(CBM_Logit_Baseline_).*$", "Joint Logit CBM (Baseline)"]
  - ["^(CEM_Baseline_).*$", "CEM (Baseline)"]
  - ["^(IntCEM_).*(_Baseline).*$", "IntCEM (Baseline)"]

model_selection_metrics:
  - val_acc_y_random_group_level_True_use_prior_False_int_auc
  - val_acc_y

shared_params:
  # Dataset Configuration
  dataset_config:
    dataset: "cub"
    num_workers: 8
    batch_size: 64

    # DATASET VARIABLES
    root_dir: /homes/me466/data/CUB200/
    sampling_percent: 1
    sampling_groups: True
    test_subsampling: 1
    weight_loss: True

  # Intervention Parameters
  intervention_config:
    competence_levels: [1]
    intervention_freq: 4
    intervention_batch_size: 512
    intervention_policies:
      - policy: "random"
        group_level: False
        use_prior: False
      - policy: "random"
        group_level: False
        use_prior: True  # We will evaluate the learnt policy of IntCEMs!
        include_run_names:
          - ".*(IntCEM).*"
      - policy: "uncertainty"
        group_level: False
        use_prior: False

  # Representation metrics
  # Change to False if you want representation metrics to be included in the
  # evaluation (may significantly increase experiment times)
  skip_repr_evaluation: True

  max_epochs: 150
  top_k_accuracy: null
  save_model: True
  patience: 15
  emb_size: 16
  extra_dims: 0
  concept_loss_weight: [1, 5, 10]
  learning_rate: 0.01
  weight_decay: 0.000004
  weight_loss: True
  c_extractor_arch: resnet18
  optimizer: sgd
  bool: False
  early_stopping_monitor: val_loss
  early_stopping_mode: min
  early_stopping_delta: 0.0
  momentum: 0.9
  sigmoidal_prob: False
  training_intervention_prob: 0
  grid_variables:
    - concept_loss_weight
  grid_search_mode: exhaustive


  # Evaluation configuration
  eval_config:
    additional_test_sets:
      - name: "GroupIncompetence"
        update_previous: True
        dataset_config:
          use_uncertainty_as_competence: True


runs:
  - architecture: 'ConceptEmbeddingModel'
    run_name: "CEM_Baseline_cwl_{concept_loss_weight}"
    sigmoidal_prob: True
    training_intervention_prob: 0.25
    concept_loss_weight: [1]
    embedding_activation: "leakyrelu"

  - architecture: 'ConceptBottleneckModel'
    run_name: "DNN_extra_dims_{extra_dims}"
    extra_dims: [200]
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    sigmoidal_prob: True
    concept_loss_weight: 0
    grid_variables:
      - extra_dims
    grid_search_mode: exhaustive

  # - architecture: 'ConceptBottleneckModel'
  #   run_name: "Hybrid-CBM_Sigmoid_extra_dims_{extra_dims}_Baseline_cwl_{concept_loss_weight}"
  #   extra_dims: [50]
  #   training_intervention_prob: 0
  #   embedding_activation: "leakyrelu"
  #   sigmoidal_prob: True
  #   concept_loss_weight: [5]
  #   grid_variables:
  #     - concept_loss_weight
  #     - extra_dims
  #   grid_search_mode: exhaustive

  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Sigmoid_Baseline_cwl_{concept_loss_weight}"
    training_intervention_prob: 0
    embedding_activation: "leakyrelu"
    bool: False
    extra_dims: 0
    concept_loss_weight: [10]
    sigmoidal_extra_capacity: False
    sigmoidal_prob: True

  - architecture: 'ConceptBottleneckModel'
    run_name: "CBM_Logit_Baseline_cwl_{concept_loss_weight}"
    embedding_activation: "leakyrelu"
    bool: False
    extra_dims: 0
    sigmoidal_extra_capacity: False
    concept_loss_weight: [10]
    sigmoidal_prob: False

  - architecture: 'SequentialConceptBottleneckModel'
    run_name: "CBM_Seq"
    embedding_activation: "leakyrelu"
    bool: False
    extra_dims: 0
    concept_loss_weight: [1]
    sigmoidal_extra_capacity: False
    sigmoidal_prob: True

  - architecture: 'IndependentConceptBottleneckModel'
    run_name: "CBM_Ind"
    embedding_activation: "leakyrelu"
    bool: False
    extra_dims: 0
    concept_loss_weight: [1]
    sigmoidal_extra_capacity: False
    sigmoidal_prob: True

  # - architecture: "IntAwareConceptEmbeddingModel"
  #   run_name: "IntCEM_emb_size_{emb_size}_intervention_weight_{intervention_weight}_intervention_task_discount_{intervention_task_discount}_Baseline_cwl_{concept_loss_weight}"
  #   training_intervention_prob: 0.25
  #   intervention_weight: [1]
  #   intervention_task_discount: [1.5]
  #   use_concept_groups: False
  #   int_model_use_bn: True
  #   int_model_layers: [128, 128, 64, 64]
  #   embedding_activation: "leakyrelu"
  #   max_horizon: 6
  #   horizon_rate: 1.005
  #   gradient_clip_val: 100
  #   emb_size: [16]
  #   concept_loss_weight: [1]
  #   grid_variables:
  #       - concept_loss_weight
  #       - intervention_task_discount
  #       - intervention_weight
  #       - emb_size
  #   grid_search_mode: exhaustive